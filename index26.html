<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="http://blog.xivo.io/theme/css/style.min.css">
  <link rel="stylesheet" type="text/css" href="http://blog.xivo.io/theme/css/pygments.min.css">
  <link rel="stylesheet" type="text/css" href="http://blog.xivo.io/theme/css/font-awesome.min.css">
  <link href="http://blog.xivo.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="XiVO Blog Atom">
  <link rel="shortcut icon" href="/public/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/public/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />
  <meta name="author" content="XiVO developers" />
  <meta name="description" content="" />
<meta property="og:site_name" content="XiVO Blog"/>
<meta property="og:type" content="blog"/>
<meta property="og:title" content="XiVO Blog"/>
<meta property="og:description" content=""/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://blog.xivo.io"/>
<meta property="og:image" content="public/xivo-logo.png">
  <title>XiVO Blog</title>
</head>
<body>
  <aside>
    <div>
      <a href="http://blog.xivo.io">
        <img src="public/xivo-logo.png" alt="" title="">
      </a>
      <h1><a href="http://blog.xivo.io"></a></h1>
      <p></p>
      <nav>
        <ul class="list">
          <li><a href="http://xivo.io" target="_blank">XiVO.io</a></li>
          <li><a href="http://documentation.xivo.io" target="_blank">Documentation</a></li>
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-twitter" href="http://twitter.com/xivodevteam" target="_blank"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-github" href="http://github.com/xivo-pbx" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-facebook" href="https://www.facebook.com/XiVO-86529730831" target="_blank"><i class="fa fa-facebook"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>
    <nav>
      <a href="http://blog.xivo.io">Home</a>
      <a href="/categories.html">Categories</a>
      <a href="/archives.html">Archives</a>
      <a href="http://blog.xivo.io/feeds/all.atom.xml">Atom</a>
    </nav>

<article>
  <header>
    <h2><a href="http://blog.xivo.io/a-gallifrey-repository-for-1116.html#a-gallifrey-repository-for-1116">A gallifrey repository for 1.1.16</a></h2>
    <p>
      Posted on Mon 13 June 2011 in <a href="http://blog.xivo.io/category/xivo-ipbx.html">XiVO IPBX</a>
      &#8226; Tagged with
      <a href="http://blog.xivo.io/tag/packages.html">packages</a>    </p>
  </header>
  <div>
      <h4>upgrading packaging-farm</h4>
<p>After the upgrade of packaging-farm to version 1.2.42, the <a href="http://gallifrey.dachary.org/packaging-farm/gallifrey/Makefile">gallifrey
Makefile</a>
was updated to add a <em>update</em> target that updates the git repositories
and schedules for build the packages that have been changed since the
last build.</p>
<div class="highlight"><pre><span class="x">update:</span>
<span class="x">        </span><span class="err">#</span><span class="x"></span>
<span class="x">        </span><span class="err">#</span><span class="x"> Submitted from the GIT repositories</span>
<span class="x">        </span><span class="err">#</span><span class="x"></span>
<span class="x">        for dir in chan_sccp asterisk dahdi-linux dahdi-tools asterisk-sounds-gsm-de-de asterisk-sounds-wav-en-us asterisk-sounds-wav-es-es asterisk-sounds-wav-fr-ca prompts-xivo prompts asternic-stats agid base-config ctiservers ctiwebclient extra fetchfw lib-python provisioning queues-logger sysconfd utils web-interface ; do packaging-farm DIRECTORY=</span><span class="p">$$</span><span class="nv">dir</span><span class="x"> submit ; done</span>
<span class="x">        </span><span class="err">#</span><span class="x"></span>
<span class="x">        </span><span class="err">#</span><span class="x"> When symbolic links needs to be resolved before building the source package</span>
<span class="x">        </span><span class="err">#</span><span class="x"></span>
<span class="x">        for dir in app_nv_faxdetect app_fax ami_aoriginate module_xivo res_config_sqlite ; do RSYNC_OPTIONS=--copy-unsafe-links packaging-farm DIRECTORY=</span><span class="p">$$</span><span class="nv">dir</span><span class="x"> submit ; done</span>
<span class="x">        </span><span class="err">#</span><span class="x"> </span>
<span class="x">        </span><span class="err">#</span><span class="x"> Retrieved from dak.proformatique.com because they are not in the GIT repositories</span>
<span class="x">        </span><span class="err">#</span><span class="x"> deb-src http://dak.proformatique.com/debian/ lenny-xivo-gallifrey-dev main</span>
<span class="x">        </span><span class="err">#</span><span class="x"> virtual packages : pf-xivo pf-xivo-backup</span>
<span class="x">        </span><span class="cp">#</span><span class="nf">cd</span><span class="x"> /var/cache/packaging-farm/sources ; for package in asterisk-chan-capi libasterisk-perl libpri misdn-kernel misdn-user sangoma-wanpipe spandsp pf-xivo pf-xivo-backup  ; do ( rm -fr </span><span class="p">$$</span><span class="nv">package</span><span class="x"> ; mkdir </span><span class="p">$$</span><span class="nv">package</span><span class="x"> ; cd </span><span class="p">$$</span><span class="nv">package</span><span class="x"> ; apt-get source </span><span class="p">$$</span><span class="nv">package</span><span class="x"> ) ; done ; packaging-farm generate</span>
</pre></div>


<p>Updating the repository can be done with</p>
<div class="highlight"><pre>packaging-farm --cd gallifrey PACKAGE= update ; packaging-farm gallifrey
</pre></div>


<h4>building gallifrey 1.1.16</h4>
<p>It failed to build <em>asterisk-chan-sccp</em></p>
<div class="highlight"><pre>packaging-farm --cd gallifrey PACKAGE= update ; packaging-farm gallifrey
</pre></div>


<p>after building successfully the following</p>
<div class="highlight"><pre><span class="mi">1115</span><span class="o">:</span><span class="n">packaging</span><span class="o">-</span><span class="n">farm</span> <span class="o">--</span><span class="n">cd</span> <span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">base</span><span class="o">-</span><span class="n">config</span> <span class="n">all</span>
   <span class="mi">3867</span><span class="o">:</span><span class="n">packaging</span><span class="o">-</span><span class="n">farm</span> <span class="o">--</span><span class="n">cd</span> <span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">cti</span><span class="o">-</span><span class="n">server</span> <span class="n">all</span>
   <span class="mi">6655</span><span class="o">:</span><span class="n">packaging</span><span class="o">-</span><span class="n">farm</span> <span class="o">--</span><span class="n">cd</span> <span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">utils</span> <span class="n">all</span>
   <span class="mi">9311</span><span class="o">:</span><span class="n">packaging</span><span class="o">-</span><span class="n">farm</span> <span class="o">--</span><span class="n">cd</span> <span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">web</span><span class="o">-</span><span class="kd">interface</span> <span class="n">all</span>
</pre></div>


<p>The log of the error is:</p>
<div class="highlight"><pre>Applying patch fix_hidden_callplane_on_transfer
patching file src/sccp_channel.c
Hunk #1 FAILED at 1556.
1 out of 1 hunk FAILED -- rejects in file src/sccp_channel.c
patching file src/sccp_indicate.c
Hunk #1 FAILED at 146.
1 out of 1 hunk FAILED -- rejects in file src/sccp_indicate.c
Patch fix_hidden_callplane_on_transfer does not apply (enforce with -f)
make[3]: *** [debian/stamp-patched] Error 1
make[3]: Leaving directory `/usr/src/asterisk-chan-sccp-0~prerelease+svn2187+pf.xivo.1.1.16~20110\
608.195041.34405d1&#39;
dpkg-buildpackage: failure: debian/rules build gave error exit status 2
</pre></div>


<p>and a bug report was filled by Nicolas Hicher so that the developers are
aware of the issue.As an interim solution, he removed the faulty patch
from the git repository and the submission was run again:</p>
<div class="highlight"><pre>packaging-farm --cd gallifrey PACKAGE= update ; packaging-farm gallifrey
</pre></div>


<p>and resumed where it left. The ntp package was installed to ensure the
date on the VM is correct. It was 13 minutes ahead in the future and it
created some confusion when synchronizing with the external repositories
was required and did not produce the intended effects.Since each package
name contains the XiVO version, if it changes ( in
<em>/var/cache/packaging-farm/VCS/sources/xivo-gallifrey/VERSION</em> ) all
packages must be rebuilt, regardless of the fact that their content
changed. The <a href="http://hg.packaging-farm.dachary.org/rev/97cac490cb5d">packaging-farm
2.0.0</a> version
contains a patch that implements this behavior.</p>
<h4>packaging-farm 2.0.0</h4>
<p>This version marks the completion of the groundwork that was necessary
to ensure that the software provides the minimal set of functionalities
required to build the XiVO repositories. All the files were reviewed as
well as the packaging instructions.</p>
<p>The HTML / PHP reporting was removed and packaging-farm is now command
line oriented only and has no web interface. A web interface could be
added in the form of a webservice supported by a javascript based
client. But it would not be an evolution of the interface that was
removed.</p>
<p>The license was upgraded from GPLv2+ (i.e. GPLv2 that can be upgraded to
any later version at the user option) to AGPLv3+ (web service oriented
license that ensure the propagation of the modifications when the
service is deployed).</p>
<p>The package was converted to
<a href="http://en.wikipedia.org/wiki/Debhelper#Overview">dh7</a> and
<a href="http://wiki.debian.org/Projects/DebSrc3.0">DebSrc3.0</a>. All lintian
warnings were fixed. An <a href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=630358">Intent To
Package</a> was
sent to schedule the inclusion in Debian GNU/Linux.</p>
</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://blog.xivo.io/caluire-town-hall-installation.html#caluire-town-hall-installation">Caluire Town Hall Installation</a></h2>
    <p>
      Posted on Tue 07 June 2011 in <a href="http://blog.xivo.io/category/services.html">Services</a>
    </p>
  </header>
  <div>
      <p><img alt="installcaluire" src="/public/.IMAG0870_m.jpg" title="installcaluire, juin 2011" /></p>
<p>I had the chance to participate to
<a href="http://www.ville-caluire.fr/">Caluire</a> town hall installation a couple
of weeks ago, where we deployed almost 150 phone sets in the building.</p>
<p>Two corporate <a href="https://wiki.xivo.fr/index.php/Accueil">XIVO</a> servers
were inserted between the legacy PBX (Matra) and the PSTN network, we
spent a lot of time to try to figure out how many channels were
available as nobody did know it and the information was lost ! ;). Once
the proper dahdi configuration was found everything started to work well
and we began to replace little by little all the phone sets.</p>
<p>Highlights :</p>
<ul>
<li>150 phone sets</li>
<li>DECT</li>
<li>Mobile gateways to optimize mobile calls cost</li>
<li>Polycom sound stations for audio conferences</li>
<li>Fax gateway, mono and multi ports</li>
</ul>
<p>As new phone sets were setup beside the old phone sets and old numbers
were forwarded to the new installed ones, users were able to gradually
become used to the new way of calling.</p>
<p>Thanks to Fred for this funny photo from the “installation war room”</p>
</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://blog.xivo.io/an-alternate-xivo-skaro-repository.html#an-alternate-xivo-skaro-repository">An alternate XiVO skaro repository</a></h2>
    <p>
      Posted on Mon 06 June 2011 in <a href="http://blog.xivo.io/category/xivo-ipbx.html">XiVO IPBX</a>
      &#8226; Tagged with
      <a href="http://blog.xivo.io/tag/packages.html">packages</a>    </p>
  </header>
  <div>
      <h4>composing skaro</h4>
<p>The gallifrey repository is made of packages built from the GIT
repositories, some extracted from the official repository because they
are not under GIT and others built for the occasion (kernel-modules and
meta-packages). The source of each package is documented in
<strong>/var/cache/packaging-farm/build/skaro/Makefile</strong> which is the
meta-package that depends on all the others:</p>
<div class="highlight"><pre><span class="x">PACKAGE=skaro</span>
<span class="x">DISTRIBUTIONS=squeeze</span>
<span class="x">COMPONENT=main</span>
<span class="x">ARCHITECTURES=i386 x86_64</span>
<span class="err">#</span><span class="x"> bntools  asterisk-chan-sccp                                                                                                                                                   </span>
<span class="x">CHILD_PACKAGES = asterisk dahdi-linux dahdi-linux-modules dahdi-tools freeswitch libpri pf-xivo-base-config pf-xivo-confgen pf-xivo-cti-server pf-xivo-extra pf-xivo-fetchfw pf-xivo-lib-js pf-xivo-lib-python pf-xivo-monitoring pf-xivo-provisioning pf-xivo-sounds pf-xivo-sysconfd pf-xivo-utils pf-xivo-web-interface pf-asterisk-res-watchdog pf-xivo pf-xivo-backup</span>
<span class="err">#</span><span class="x">                                                                                                                                                                               </span>
<span class="err">#</span><span class="x"> Waiting to be completed:                                                                                                                                                      </span>
<span class="err">#</span><span class="x"> bntools chan_sccp                                                                                                                                                             </span>
<span class="x">submit:</span>
<span class="x">        </span><span class="err">#</span><span class="x">                                                                                                                                                                       </span>
<span class="x">        </span><span class="err">#</span><span class="x"> Submitted from the GIT repositories                                                                                                                                   </span>
<span class="x">        </span><span class="err">#</span><span class="x">                                                                                                                                                                       </span>
<span class="x">        for dir in agid asterisk base-config confgen ctiservers dahdi-linux dahdi-tools extra fetchfw freeswitch lib-javascript lib-python monitoring provisioning sysconfd uti\</span>
<span class="x">ls wanpipe web-interface xivo_ha xivo-sounds ; do packaging-farm DIRECTORY=</span><span class="p">$$</span><span class="nv">dir</span><span class="x"> submit ; done</span>
<span class="x">        </span><span class="err">#</span><span class="x">                                                                                                                                                                       </span>
<span class="x">        </span><span class="err">#</span><span class="x"> When symbolic links needs to be resolved before building the source package                                                                                           </span>
<span class="x">        </span><span class="err">#</span><span class="x">                                                                                                                                                                       </span>
<span class="x">        for dir in res_watchdog ; do RSYNC_OPTIONS=--copy-unsafe-links packaging-farm DIRECTORY=</span><span class="p">$$</span><span class="nv">dir</span><span class="x"> submit ; done</span>
<span class="x">        </span><span class="err">#</span><span class="x">                                                                                                                                                                       </span>
<span class="x">        </span><span class="err">#</span><span class="x">                                                                                                                                                                       </span>
<span class="x">        </span><span class="err">#</span><span class="x"> Retrieved from dak.proformatique.com because they are not in the GIT repositories                                                                                     </span>
<span class="x">        </span><span class="err">#</span><span class="x"> deb-src http://dak.proformatique.com/debian/ squeeze-xivo-skaro-dev main                                                                                              </span>
<span class="x">        </span><span class="err">#</span><span class="x"> virtual packages : pf-xivo pf-xivo-backup                                                                                                                             </span>
<span class="x">        for package in libpri pf-xivo pf-xivo-backup  ; do ( rm -fr </span><span class="p">$$</span><span class="nv">package</span><span class="x"> ; mkdir </span><span class="p">$$</span><span class="nv">package</span><span class="x"> ; cd </span><span class="p">$$</span><span class="nv">package</span><span class="x"> ; apt-get source </span><span class="p">$$</span><span class="nv">package</span><span class="x"> ) ; done</span>

<span class="x">ROLE = meta-package</span>
</pre></div>


<p>The hand made packages (i.e. Makefiles) can be retrieved from their
respective repositories:</p>
<ul>
<li>http://skaro.dachary.org/packaging-farm/skaro/Makefile</li>
<li>http://skaro.dachary.org/packaging-farm/dahdi-linux-modules/Makefile</li>
</ul>
<p>The packages are built for two architectures : i386 and x86_64</p>
<div class="highlight"><pre>ARCHITECTURES=i386 x86_64
</pre></div>


<p>Mirroring the http://skaro.dachary.org/packaging-farm/ directory is
enough to get all the information required to re-install a
packaging-farm from scratch.It can be used by adding the following to
/etc/apt/sources.list</p>
<div class="highlight"><pre><span class="k">deb</span> <span class="s">http://skaro.dachary.org/packaging-farm/skaro/gnulinux/debian</span> <span class="kp">skaro-squeeze</span> <span class="kp">main</span>
</pre></div>


<h4>troubleshooting</h4>
<p>The pf-xivo-extra produced an error:</p>
<div class="highlight"><pre><span class="n">cp</span><span class="o">:</span> <span class="n">cannot</span> <span class="n">stat</span> <span class="err">`</span><span class="n">debian</span><span class="sr">/tmp/</span><span class="n">README</span><span class="err">&#39;</span><span class="o">:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="n">or</span> <span class="n">directory</span>
<span class="n">dh_install</span><span class="o">:</span> <span class="n">cp</span> <span class="o">-</span><span class="n">a</span> <span class="n">debian</span><span class="sr">/tmp/README debian/pf-xivo-extra/usr/share/pf-xivo-extra//</span> <span class="n">returned</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">1</span>
</pre></div>


<p>Nicolas Hicher logged in the machine and went to debug into the chroot
used to create the package:</p>
<div class="highlight"><pre>packaging-farm --cd pf-xivo-extra DISTRIBUTION=squeeze ARCHITECTURE=x86_64 chroot-login
</pre></div>


<p>It turns out that the package is not properly built from git. The
submit-xivo.sh corrupted the source distribution when called twice on
the same package. The problem was fixed in the new
<a href="http://packaging-farm.dachary.org/download/">1.2.42</a> packaging-farm
release.The i386 squeeze chroot had a flaw that forced the installation
of x11 when installing the devscripts package. The chroot was re-created
using the following:</p>
<div class="highlight"><pre>pbuilder --create --architecture i386 --distribution squeeze --basetgz /var/cache/pbuilder/squeeze-i386.tgz
</pre></div>


<p>The only package that could not be rebuilt was pf-asterisk-res-watchdog
and a bug was reported regarding its <a href="https://projects.xivo.fr/issues/2302">missing build depend to
python</a>.</p>
<h4>managing timestamps when submitting a package</h4>
<p>The oneliner that could be used to rebuild XiVO with all the updates
from the git repositories is :</p>
<div class="highlight"><pre>cd /var/cache/packaging-farm/build/skaro ; make submit ; packaging-farm skaro
</pre></div>


<p>It involves calling submit-xivo.sh for all known packages and therefore
trigger a recompilation of each package, even those that were not
changed since the last compilation. That can be avoided by selecting the
relevant packages, using a method similar to the <a href="http://blog.xivo.fr/index.php?post/2011/05/30/Using-and-Updating-a-XiVO-gallifrey-repository">one described in a
previous
post</a>.
To avoid a manual selection, the submit-xivo.sh was modified to do
nothing if it notices that the git repositories do not contain any
commit more recent than the timestamp updated when the last compilation
completed successfully.</p>
<div class="highlight"><pre>function need_update() {
    local package=&quot;$1&quot;
    local dir=&quot;$2&quot;
    local suite=&quot;$3&quot;
    local xivo=&quot;$4&quot;

    if [ ! -f <span class="cp">${</span><span class="n">DEPENDS_DIR</span><span class="cp">}</span>/<span class="cp">${</span><span class="n">package</span><span class="cp">}</span> ] ; then
        return 0
    else
        modified=$(stat --terse --printf=%Y <span class="cp">${</span><span class="n">DEPENDS_DIR</span><span class="cp">}</span>/<span class="cp">${</span><span class="n">package</span><span class="cp">}</span>)
        (
            cd <span class="cp">${</span><span class="n">VCS_DIR</span><span class="cp">}</span>/sources/xivo-<span class="cp">${</span><span class="n">xivo</span><span class="cp">}</span>/<span class="cp">${</span><span class="nb">dir</span><span class="cp">}</span>
            git log -1 --after=<span class="cp">${</span><span class="n">modified</span><span class="cp">}</span> .
            cd <span class="cp">${</span><span class="n">VCS_DIR</span><span class="cp">}</span>/debian/<span class="cp">${</span><span class="n">suite</span><span class="cp">}</span>-xivo-<span class="cp">${</span><span class="n">xivo</span><span class="cp">}</span>/<span class="cp">${</span><span class="n">package</span><span class="cp">}</span>
            git log -1 --after=<span class="cp">${</span><span class="n">modified</span><span class="cp">}</span> .
        ) &gt; /tmp/submit$$
        [ -s /tmp/submit$$ ]
        result=$?
        rm /tmp/submit$$
        return <span class="nv">$result</span>
    fi
}
</pre></div>


</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://blog.xivo.io/using-and-updating-a-xivo-gallifrey-repository.html#using-and-updating-a-xivo-gallifrey-repository">Using and Updating a XiVO gallifrey repository</a></h2>
    <p>
      Posted on Mon 30 May 2011 in <a href="http://blog.xivo.io/category/xivo-ipbx.html">XiVO IPBX</a>
      &#8226; Tagged with
      <a href="http://blog.xivo.io/tag/packages.html">packages</a>    </p>
  </header>
  <div>
      <h4>Updating the repository</h4>
<p>To figure out what needs updating, a query is made on the git
repositories.</p>
<div class="highlight"><pre>cd /var/cache/packaging-farm/VCS/sources/xivo-gallifrey
git fetch
git log --stat=2000,2000 ..origin/master
</pre></div>


<p>The <em>--stat</em> option shows which files are modified and the numbers after
it ensure that they are not truncated. The first component of the file
name designate the directory of interest. For instance</p>
<div class="highlight"><pre>chan_sccp/patches/fix_forward_on_bad_numbers       |   13 ++
 chan_sccp/patches/fix_useless_channel_unlocks      |  155 ++++++++++++++++++++
</pre></div>


<p>says that we need to re-submit as follows:</p>
<div class="highlight"><pre>packaging-farm DIRECTORY=chan_sccp submit
</pre></div>


<p>The same should be done for the git repository of the debian packages</p>
<div class="highlight"><pre>cd /var/cache/packaging-farm/VCS/debian/lenny-xivo-gallifrey
git fetch
git log --stat=2000,2000 ..origin/master
</pre></div>


<p>There was a need to re-submit the following:</p>
<div class="highlight"><pre><span class="x">for dir in web-interface chan_sccp ctiservers</span>
<span class="x">do </span>
<span class="x">  packaging-farm DIRECTORY=</span><span class="p">$</span><span class="nv">dir</span><span class="x"> submit</span>
<span class="x">done</span>
</pre></div>


<p>and the repository was updated with:</p>
<div class="highlight"><pre>packaging-farm gallifrey
</pre></div>


<p>after checking what would be done with</p>
<div class="highlight"><pre>packaging-farm -n gallifrey
</pre></div>


<p>The <em>-n</em> flag semantic can be found in the GNU make documentation. The
<em>packaging-farm</em> command wraps the <em>make</em> command.</p>
<h4>Packaging farm release</h4>
<p>The <a href="http://packaging-farm.dachary.org/download">1.2.41</a> version of
packaging-farmcontains documentation improvements ( packaging-farm and
packaging-farm.conf manual pages ) about troubleshooting a process that
prevents a directory to umount and using RSYNC options to control what
is being copied when building the package (for instance to ensure that
the symbolic link target is copied instead of the symbolic link).The
dependency graph failed to build the required packages: although it was
accurate, in some cases it missed the corresponding action. As a
consequence the child of the graph were updated but not the topmost
parents.</p>
<h4>Using XiVO with OVH</h4>
<p>A <a href="https://gallifrey-test1.dachary.org/">virtual machine was setup</a>
using the <a href="http://gallifrey.dachary.org/packaging-farm/gallifrey">gallifrey
repository</a> and
the following command:</p>
<div class="highlight"><pre>apt-get install pf-xivo
</pre></div>


<p>The host firewall was configured to send the <em>5060</em> port to the virtual
machine and forward the https port to the nginx proxy:</p>
<div class="highlight"><pre><span class="gd">--- a/shorewall/params</span>
<span class="gi">+++ b/shorewall/params</span>
<span class="gu">@@ -28,4 +28,5 @@ IP_FAILOVER=66.254.41.119</span>
 VM_DEV_DACHARY=10.10.60.1
 VM_SKARO_XIVO=10.10.60.2
 VM_GALLIFREY_XIVO=10.10.60.3
<span class="gi">+VM_GALLIFREY_TEST1=10.10.60.4</span>
 #LAST LINE -- DO NOT REMOVE
<span class="gh">diff --git a/shorewall/rules b/shorewall/rules</span>
<span class="gh">index 3a7ea65..66161c0 100644</span>
<span class="gd">--- a/shorewall/rules</span>
<span class="gi">+++ b/shorewall/rules</span>
<span class="gu">@@ -39,11 +39,15 @@ ACCEPT              $FW             net             icmp</span>

 SSH(ACCEPT)    net             $FW
 HTTP(ACCEPT)   net             $FW
<span class="gi">+HTTPS(ACCEPT)  net             $FW</span>
 # VNC ganeti
 ACCEPT         net             $FW             tcp     11000:11010
 # VNC libvirt
 ACCEPT         net             $FW             tcp     5900:5910

<span class="gi">+DNAT           net             loc:$VM_GALLIFREY_TEST1 tcp            5060           -       $IP_FAILOVER</span>
<span class="gi">+DNAT           net             loc:$VM_GALLIFREY_TEST1 udp            5060           -       $IP_FAILOVER</span>
<span class="gi">+</span>
 # SSH remap
 DNAT           net             loc:$VM_DEV_DACHARY:22 tcp            22001           -       $IP_FAILOVER
 DNAT           net             loc:$VM_SKARO_XIVO:22 tcp             22002           -       $IP_FAILOVER
</pre></div>


<p>The nginx proxy was configured to reverse proxy https:</p>
<div class="highlight"><pre><span class="gh">diff --git a/nginx/sites-available/gallifrey-test2.dachary.org b/nginx/sites-available/gallifrey-test2.dachary.org</span>
new file mode 100644
<span class="gh">index 0000000..2525ff9</span>
<span class="gd">--- /dev/null</span>
<span class="gi">+++ b/nginx/sites-available/gallifrey-test2.dachary.org</span>
<span class="gu">@@ -0,0 +1,13 @@</span>
<span class="gi">+server {</span>
<span class="gi">+ ssl on;</span>
<span class="gi">+ listen 443;</span>
<span class="gi">+ server_name gallifrey-test2.dachary.org;</span>
<span class="gi">+ access_log  /var/log/nginx/gallifrey.dachary.org.access.log;</span>
<span class="gi">+ ssl_certificate /etc/nginx/server.crt;</span>
<span class="gi">+ ssl_certificate_key /etc/nginx/server.key;</span>
<span class="gi">+</span>
<span class="gi">+ location / {</span>
<span class="gi">+  proxy_pass https://10.10.70.71:443;</span>
<span class="gi">+#  proxy_set_header Host $host;</span>
<span class="gi">+ }</span>
<span class="gi">+}</span>
</pre></div>


<p>And the corresponding certificates created as instructed in the nginx
documentation.The <a href="https://wiki.xivo.fr/index.php/XiVO_1.1-Gallifrey/Trunk_SIP">IPPI
instructions</a>
were followed to connect the XiVO just created with an <a href="http://www.ovh.com/fr/telephonie/">OVH phone
number</a>. All of the instructiosn
listed for IPPI apply to OVH because they use the same system (Cirpack).
The values for DTMF were left unchanged and NAT set to <em>Yes</em>.Debugging
was made convenient with the asterisk console</p>
<div class="highlight"><pre><span class="nv">$ </span>asterisk -rvvvvv
gallifrey-test1*CLI&gt; sip show registry
Host                            Username       Refresh State                Reg.Time                 
sip.ovh.net:5060                <span class="m">003384452800</span>       <span class="m">105</span> Registered           Mon, <span class="m">23</span> May <span class="m">2011</span> 11:38:12
</pre></div>


<p>And the actual SIP requests could be viewed with</p>
<div class="highlight"><pre>gallifrey-test1*CLI&gt; set debug peer trunk_ovh
</pre></div>


<p>which was most convenient to submit the problems to
irc.freenode.net#xivo and irc.freenode.net#asterisk.</p>
<h4>Independent install of XiVO</h4>
<p>Nicolas Hicher installed XiVO using</p>
<div class="highlight"><pre><span class="k">deb</span> <span class="s">http://gallifrey.dachary.org/packaging-farm/gallifrey/gnulinux/debian</span> <span class="kp">gallifrey-lenny</span> <span class="kp">main</span>
</pre></div>


<p>and</p>
<div class="highlight"><pre>apt-get install dahdi-linux-modules-2.6.26-2-486
apt-get install pf-xivo
</pre></div>


<p>(the actual package was adapted to the running kernel) and reported
success</p>
<div class="highlight"><pre>(11:53:20 AM) atarakt: Installation successful !!!
(11:53:24 AM) atarakt: excellent =)
(11:54:28 AM) atarakt: j&#39;ai un xivo qui tourne
(11:57:37 AM) dachary: oO
(11:57:50 AM) ***dachary débouche le champagne
</pre></div>


</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://blog.xivo.io/coming-back-from-solutions-linux-2011.html#coming-back-from-solutions-linux-2011">Coming back from Solutions Linux 2011</a></h2>
    <p>
      Posted on Thu 19 May 2011 in <a href="http://blog.xivo.io/category/general.html">General</a>
    </p>
  </header>
  <div>
      <p>We had to opportunity to demonstrate our prototype of the XiVO IPBX
OpenHardware with 3 different phones connected to the appliance
(original orange french Socotel S63 analog phone, Siemens Gigaset SX353
ISDN phone and Aastra 6731i SIP phone) and available through our
softwitch interface.The mini-conference was also the opportunity to
exchange with different hardware engineers in the telecommunications
field about OpenHardware designs and PCB fabs in Europe. We hope this
will help the telco OpenHardware community to grow in the coming months.</p>
</p>
  </div>
</article>

  <div class="pagination">
    <a class="btn" href="http://blog.xivo.io/index27.html">
      <i class="fa fa-angle-left"></i> Older Posts
    </a>
      <a class="btn float-right" href="http://blog.xivo.io/index25.html">
        Newer Posts <i class="fa fa-angle-right"></i>
      </a>
  </div>

    <footer>
<p>
  &copy; XiVO developers 2015 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Create Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " XiVO Blog ",
  "url" : "http://blog.xivo.io",
  "image": "public/xivo-logo.png",
  "description": ""
}
</script></body>
</html>