<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="http://blog.xivo.io/theme/css/style.min.css">
  <link rel="stylesheet" type="text/css" href="http://blog.xivo.io/theme/css/pygments.min.css">
  <link rel="stylesheet" type="text/css" href="http://blog.xivo.io/theme/css/font-awesome.min.css">
  <link href="http://blog.xivo.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="XiVO Blog Atom">
  <link rel="shortcut icon" href="/public/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/public/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />
  <meta name="author" content="XiVO developers" />
  <meta name="description" content="" />
<meta property="og:site_name" content="XiVO Blog"/>
<meta property="og:type" content="blog"/>
<meta property="og:title" content="XiVO Blog"/>
<meta property="og:description" content=""/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://blog.xivo.io"/>
<meta property="og:image" content="public/xivo-logo.png">
  <title>XiVO Blog</title>
</head>
<body>
  <aside>
    <div>
      <a href="http://blog.xivo.io">
        <img src="public/xivo-logo.png" alt="" title="">
      </a>
      <h1><a href="http://blog.xivo.io"></a></h1>
      <p></p>
      <nav>
        <ul class="list">
          <li><a href="http://xivo.io" target="_blank">XiVO.io</a></li>
          <li><a href="http://documentation.xivo.io" target="_blank">Documentation</a></li>
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-twitter" href="http://twitter.com/xivodevteam" target="_blank"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-github" href="http://github.com/xivo-pbx" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-facebook" href="https://www.facebook.com/XiVO-86529730831" target="_blank"><i class="fa fa-facebook"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>
    <nav>
      <a href="http://blog.xivo.io">Home</a>
      <a href="/categories.html">Categories</a>
      <a href="/archives.html">Archives</a>
      <a href="http://blog.xivo.io/feeds/all.atom.xml">Atom</a>
    </nav>

<article>
  <header>
    <h2><a href="http://blog.xivo.io/creating-a-debian-gnulinux-source-package-from-the-vcs-22.html#creating-a-debian-gnulinux-source-package-from-the-vcs-22">Creating a Debian GNU/Linux source package from the VCS (2/2)</a></h2>
    <p>
      Posted on Mon 14 March 2011 in <a href="http://blog.xivo.io/category/xivo-ipbx.html">XiVO IPBX</a>
      &#8226; Tagged with
      <a href="http://blog.xivo.io/tag/packages.html">packages</a>    </p>
  </header>
  <div>
      <h4>pf-release.sh</h4>
<p>The <a href="http://xivo.dachary.org/pf-release.sh">pf-release.sh shell script</a>
merges the <a href="http://git.xivo.fr/xivo-skaro.git/">GIT repository</a>
containing the sources and the SVN repository containing the debian
packages into a well formed Debian GNU/Linux source package. For
instance</p>
<div class="highlight"><pre><span></span>pf-release.sh lib-javascript squeeze skaro
</pre></div>


<p>would create the <em>pf-xivo-lib-js</em> package. The discussion about the
<a href="https://lists.proformatique.com/pipermail/xivo-dev/2011-March/000012.html">publication of the private SVN
repostory</a>
concluded that it will be bound to a public GIT repository shortly. When
it is ready, the pf-release.sh script will be updated accordingly.In
order to test the <em>pf-release.sh</em> code, it can be run with the <em>TEST</em>
argument:</p>
<div class="highlight"><pre><span></span>pf-release.sh TEST
</pre></div>


<p>This will simulate border cases using a temporary direcotry to check
that it behaves as expected. Reading the tests (which are embeded in the
script) is currently the only documentation.</p>
<h4>packaging-farm submission</h4>
<p>The output of <em>pf-release.sh</em> is stored in a directory that uses the
same conventions as packaging-farm. Because of that, submitting the
package to the host running the packaging farm can be done by copying
the directory as follows:</p>
<div class="highlight"><pre><span></span>rsync -av pf-xivo-lib-js/ packaging-farm.org:/var/lib/packaging-farm/sources/pf-xivo-lib-js/
</pre></div>


<h4>dependency generation</h4>
<p>A recent addition to the packaging-farm was the automatic generation of
dependencies. It calculates which source package depends on other
packages built by the packaging-farm. Support for meta packages was
added to the dependency generation. In the packaging-farm vocabulary, a
meta package is a package that aggregates others but has no sources of
its own. For instance, the meta package <em>skaro</em> was created to produce
the <a href="http://xivo.dachary.org/packaging-farm/skaro/gnulinux/debian/">skaro squeeze
repository</a>.
When running the depencency generations as follows:</p>
<div class="highlight"><pre><span></span>packaging-farm depends
</pre></div>


<p>it includes the meta packages in the graph so that skaro can be built
with:</p>
<div class="highlight"><pre><span></span>packaging-farm skaro
</pre></div>


<p>If, for instance, <em>pf-xivo-lib-js</em> has been updated as shown with the
<em>rsync</em> command above it will be rebuilt because the skaro meta package
depends on it.</p>
<h4>makefile generation</h4>
<p>Each package entering the packaging-farm must have a <em>Makefile</em>
associated with it. Setting the variables in this <em>Makefile</em> allows the
administrator to tune the behaviour on a per package basis. When a
package is simple enough, its <em>Makefile</em> can be automatically generated
as follows:</p>
<div class="highlight"><pre><span></span>packaging-farm makefiles
</pre></div>


<h4>packaging-farm sensible defaults</h4>
<p>The <a href="http://packaging-farm.dachary.org/download/">version 1.2.33</a> of
packaging-farm includes the modifications above to help reduce the
number of steps required to rebuild a suite or a specific package.
Submitting a package requires four steps:</p>
<ul>
<li>pf-release.sh</li>
<li>rsync</li>
<li>packaging-farm generate which calls depends and makefiles</li>
<li>packaging-farm the_package</li>
</ul>
<p>This completes the making of the building blocks enabling the creation
and maintainance of packages based on the XiVO development repository.
The next step will be to document and simplify the usage, reducing the
learning curve to a minimum.</p>
</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://blog.xivo.io/the-road-to-the-final-pcb-layout-routing-of-the-cpu-board.html#the-road-to-the-final-pcb-layout-routing-of-the-cpu-board">The road to the final PCB layout routing of the CPU board</a></h2>
    <p>
      Posted on Fri 11 March 2011 in <a href="http://blog.xivo.io/category/xivo-ipbx.html">XiVO IPBX</a>
    </p>
  </header>
  <div>
      <p>We are now entering the road to the final PCB layout routing of the CPU
board of our XiVO IPBX OpenHardware with the gathering of our schematic
design on the CPU board of our IPBX. The current step is to place the
component, check the package of each component in the library (Lbr in
Eagle), double-check the schematics associated to the layout and prepare
the final routing of the netwire optimized for our 10-layers design. We
will document the BoM step with different posts coming up and namely the
optimization of the components sourcing.</p>
</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://blog.xivo.io/creating-a-debian-gnulinux-source-package-from-the-xivo-vcs-12.html#creating-a-debian-gnulinux-source-package-from-the-xivo-vcs-12">Creating a Debian GNU/Linux source package from the XiVO VCS (1/2)</a></h2>
    <p>
      Posted on Mon 07 March 2011 in <a href="http://blog.xivo.io/category/xivo-ipbx.html">XiVO IPBX</a>
      &#8226; Tagged with
      <a href="http://blog.xivo.io/tag/packages.html">packages</a>    </p>
  </header>
  <div>
      <h4>Source GIT structure</h4>
<p>The <a href="http://git.xivo.fr/xivo-skaro.git/">GIT repository</a> can be
extracted as follows:</p>
<div class="highlight"><pre><span></span>git clone git://git.xivo.fr/xivo-skaro.git
</pre></div>


<p>It contains a directory for each source package found in the <a href="http://dak.proformatique.com/debian/dists/squeeze-xivo-skaro-dev/">skaro
repository</a>.
The names of the directories are mapped to the package names as follows:</p>
<div class="highlight"><pre><span></span>agid -&gt; pf-xivo-agid
app_nv_faxdetect -&gt; pf-asterisk-app-nv-faxdetect
asterisk -&gt; asterisk
base-config -&gt; pf-xivo-base-config
bntools -&gt; bntools
chan_sccp -&gt; asterisk-chan-sccp
confgen -&gt; pf-xivo-confgen
ctiservers -&gt; pf-xivo-cti-server
dahdi-linux -&gt; dahdi-linux
dahdi-tools -&gt; dahdi-tools
extra -&gt; pf-xivo-extra
fetchfw -&gt; pf-xivo-fetchfw
freeswitch -&gt; freeswitch
lib-javascript -&gt; pf-xivo-lib-js
lib-python -&gt; pf-xivo-lib-python
monitoring -&gt; pf-xivo-monitoring
provisioning -&gt; pf-xivo-provisioning
queues-logger -&gt; pf-xivo-queues-logger
res_watchdog -&gt; pf-asterisk-res-watchdog
sysconfd -&gt; pf-xivo-sysconfd
utils -&gt; pf-xivo-utils
web-interface -&gt; pf-xivo-web-interface
xivo-sounds -&gt; pf-xivo-sounds
</pre></div>


<p>The mapping is found in the <code>*/Makefile.pkg</code> file, in the <code>DEB_PKG</code>
variable, such as</p>
<div class="highlight"><pre><span></span>DEB_PKG=&quot;pf-xivo-monitoring&quot;
</pre></div>


<p>There are two sets of directories : the software imported from a third
party (asterisk, for instance) and the software developped natively.The
source tarbal of a native package is created from a tar of the
directory, not including the directory name. For instance, the
<a href="http://dak.proformatique.com/debian/pool/main/p/pf-xivo-cti-server/pf-xivo-cti-server_1.2~svn10269.orig.tar.gz">pf-xivo-cti-server
tarbal</a>
contains:</p>
<div class="highlight"><pre><span></span>-rw-r--r--    root/root        305 ./Makefile.pkg
 -rw-r--r--    root/root       6922 ./xivo_daemon.conf
 -rw-r--r--    root/root      35068 ./LICENSE
 drwxr-xr-x    root/root          0 ./xivo_ctiservers/
 -rw-r--r--    root/root       8011 ./xivo_ctiservers/cti_trunklist.py
 -rw-r--r--    root/root      13509 ./xivo_ctiservers/xivo_phones.py
 -rw-r--r--    root/root       3199 ./xivo_ctiservers/cti_presence.py
...
</pre></div>


<p>The source tarbal of a third party package is created with a tar of the
<code>patches</code> and <code>tarballs</code> directories alone. The rest of the files are
used during the development cycle ( such as asterisk/fetch_tarball.sh
to synchronize with the asterisk upstream ) and are out of the scope of
this discussion. For instance, the content of the <a href="http://dak.proformatique.com/debian/pool/main/d/dahdi-linux/dahdi-linux_2.4.1.0+dfsg+pf.xivo.1.2~svn10330.orig.tar.gz">dahdi-linux
tarbal</a>
is as follows:</p>
<div class="highlight"><pre><span></span>drwxr-xr-x    root/root          0 ./patches/
 -rw-r--r--    root/root       1106 ./patches/enable_oslec.diff
 -rw-r--r--    root/root        776 ./patches/no_firmware_download
 -rw-r--r--    root/root         39 ./patches/series
 -rw-r--r--    root/root    1147443 ./dahdi-linux_2.4.1.0+dfsg.orig.tar.gz
</pre></div>


<p>Note that the tarbal is moved up one directory and the <code>tarballs</code>
directory does not show. The actual content of the corresponding GIT
repository is as follows:</p>
<div class="highlight"><pre><span></span>dahdi-linux/prepare_test_sources
dahdi-linux/sources.pkg
dahdi-linux/SOURCE-VERSION
dahdi-linux/AUTOBUILD-IGNORE
dahdi-linux/Makefile.pkg
dahdi-linux/tarballs
dahdi-linux/tarballs/dahdi-linux_2.4.1+dfsg.orig.tar.gz
dahdi-linux/fetch_sources
dahdi-linux/patches/series
dahdi-linux/patches/no_firmware_download
</pre></div>


<p>None of the source directories contain version numbers. A convention
involving a SVN version number (a SVN repository is used behind the GIT)
and the content of the <code>VERSION</code> file (1.2 for skaro) is used to
generate a version (such as the <code>1.2~svn10330</code> part of
<code>dahdi-linux_2.4.1.0+dfsg+pf.xivo.1.2~svn10330.orig.tar.gz</code>). A simpler
convention is <a href="https://lists.proformatique.com/pipermail/xivo-dev/2011-March/000008.html">being
discussed</a>
to cope with two issues:</p>
<ul>
<li>the SVN version is not available to the general public</li>
<li>the global version number (1.2 for skaro) is redundant and could be
    ignored</li>
</ul>
<p>The directory <code>tools</code> is not a package. It contains files shared and
duplicated in some native packages. For instance <code>gwr.py</code>:</p>
<div class="highlight"><pre><span></span>app_nv_faxdetect/gwr.py -&gt; ../tools/gwr.py
 res_watchdog/gwr.py -&gt; ../tools/gwr.py
 tools/gwr.py
</pre></div>


<p>In order to ensure the inclusion of the file itself when the tarbal is
created, the <code>-h</code> is used to store the content of the symbolic link
instead of the symbolic link itself.Some sources, such as <code>libpri</code> are
unmodified ports of the standard package and do not require special
handling.</p>
<h4>Debian package SVN structure</h4>
<p>The Debian GNU/Linux package are stored in an internal SVN and its
publication is <a href="https://lists.proformatique.com/pipermail/xivo-dev/2011-March/000012.html">being
discussed</a>.
The information can be retrieved from the source packages but the
history is lost to the general public. The SVN tree is structured using
a path named after the XiVO version and the Debian GNU/Linux version it
is based on. For instance:</p>
<div class="highlight"><pre><span></span>package=asterisk
    suite=squeeze
    xivo=skaro

    means the packaging information will be found in

    packages/branches/official/<span class="cp">${</span><span class="n">suite</span><span class="cp">}</span>-xivo-<span class="cp">${</span><span class="n">xivo</span><span class="cp">}</span>/<span class="cp">${</span><span class="n">package</span><span class="cp">}</span>/trunk/debian
</pre></div>


<p>If the version found in <code>debian/changelog</code> does not reflect the source
version number (for instance 2.4.1.0+dfsg+pf.xivo.1.2\~svn10330 in the
chapter above), a new changelog entry will be created to match it. When
this sanity check is done (and assuming the source tarbal is available
in the upper directory), the source package can be created with:</p>
<div class="highlight"><pre><span></span>dpkg-buildpackage -S -uc -us
</pre></div>


<p>Although most packages contain a
<a href="http://cdbs-doc.duckcorp.org/en/cdbs-doc.xhtml">debian/control.in</a>
file, the corresponding <code>debian/control</code> is commited to in the SVN
repository. The CDBS documentation suggests it is not a mature feature
and it could probably be ignored. The newer <a href="http://en.wikipedia.org/wiki/Debhelper#Overview">debhelper version
7</a> could prefered to
CDBS in the future.</p>
<h4>Implementing the source package logic</h4>
<p>A <a href="http://xivo.dachary.org/pf-release.sh">shell script stub has been
created</a> to implement the logic
described above, together with embeded tests. When the SVN containing
the Debian GNU/Linux packaging information will be available, it will
create the source packages that can be fed to
<a href="packaging-farm">http://packaging-farm.dachary.org/</a> in order to create
a <a href="http://xivo.dachary.org/packaging-farm/skaro/gnulinux/debian/">XiVO skaro
repository</a>
described in the <a href="http://blog.xivo.fr/index.php?post/2011/02/22/Creating-an-independant-XiVO-Debian-GNU/Linux-repository-from-scratch-%28part-4/4%29">series on building an independant XiVO
repository</a>.In
the second part of this entry, the script will be complete and a the
XiVO skaro repository updated.</p>
</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://blog.xivo.io/looking-for-technical-documentation-on-the-matra-rc1173a.html#looking-for-technical-documentation-on-the-matra-rc1173a">Looking for technical documentation on the Matra RC1173A</a></h2>
    <p>
      Posted on Fri 04 March 2011 in <a href="http://blog.xivo.io/category/voip.html">VoIP</a>
    </p>
  </header>
  <div>
      <p>The picture below presents the only connector available on the Matra
RC1173A  </p>
<p><img alt="RC1173A
connector" src="/public/.P1050040_m.jpg" title="RC1173A connector, mar. 2011" /></p>
<p>After some studies, it seems that device is a "pupitre" from MATRA that
sould be connected to a PABX Matracom (45xx series) of CGCT type.The
device seems to be using a micro-controler Philips/RTC 84C21 and 84C85
using probably the firmware HX00070xx et HX00072xx</p>
</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://blog.xivo.io/candidate-xivo-skaro-repository-for-x86_64.html#candidate-xivo-skaro-repository-for-x86_64">Candidate XiVO skaro repository for x86_64</a></h2>
    <p>
      Posted on Mon 28 February 2011 in <a href="http://blog.xivo.io/category/xivo-ipbx.html">XiVO IPBX</a>
    </p>
  </header>
  <div>
      <h4>XiVO skaro repository for x86_64</h4>
<p>Last week Nicolas Hicher completed a release candidate for the <a href="http://dak.proformatique.com/debian/dists/squeeze-xivo-skaro-dev/">i386
XiVO skaro
repository</a>.
Although the repository claims to support the x86_64/amd64
architecture, the <a href="http://dak.proformatique.com/debian/dists/squeeze-xivo-skaro-dev/main/binary-amd64/Packages">amd64 packages are
missing</a>.
All the source packages were fetched in an attempt to build a x86_64
repository. The following problems were found and fixed:</p>
<ul>
<li><a href="https://projects.proformatique.com/issues/1998">dahdi-linux patch for
    squeeze-i386</a></li>
<li><a href="https://projects.proformatique.com/issues/1999">spandsp patch for
    squeeze-x86_64</a></li>
<li><a href="https://projects.proformatique.com/issues/2000">asterisk-1.8 unresolved dependency to postgres 8.3 on
    debian/squeeze</a></li>
<li><a href="https://projects.proformatique.com/issues/2001">pf-xivo-fetchfw missing dependency for
    skaro</a></li>
<li><a href="https://projects.proformatique.com/issues/2002">pf-xivo-provisioning missing dependency for
    skaro</a></li>
<li><a href="https://projects.proformatique.com/issues/2006">pf-xivo-confgen missing dependency for
    skaro</a></li>
</ul>
<p>A problem on the <a href="https://projects.proformatique.com/issues/2003">misdn-kernel
modules</a> was left
unresolved, in the hope that Nicolas Hicher already knows the solution.
A <a href="https://projects.proformatique.com/issues/2007">question</a> about an
unusual pf-xivo-base-config and pf-xivo-web-interface interdendency was
posted for discussion. None of these problems were blockers and their
resolution was not mandatory.</p>
<h4>Installation on Debian GNU/Linux squeeze</h4>
<p>The resulting repository was added as follows to a fresh install of
Debian GNU/Linux squeeze:</p>
<div class="highlight"><pre><span></span><span class="k">deb</span> <span class="s">http://xivo.dachary.org/packaging-farm/skaro/gnulinux/debian</span> <span class="kp">skaro-squeeze</span> <span class="kp">main</span>
</pre></div>


<p>A single package was missing ( <code>pf-sys-ca</code> ) and required the addition
of a repository:</p>
<div class="highlight"><pre><span></span><span class="k">deb</span> <span class="s">http://dak.proformatique.com/debian</span> <span class="kp">lenny-dev</span> <span class="kp">main</span>
</pre></div>


<p>In the hope of reducing the configuration work,
<a href="http://wiki.debian.org/DebianInstaller/Preseed">preseed</a> information
was extracted from the <a href="git://git.proformatique.com/official/debian-installer.git">debian-installer XiVO
repository</a>
and applied as follows:</p>
<div class="highlight"><pre><span></span><span class="nt">wget</span> <span class="nt">-O</span> <span class="nt">installed</span><span class="nc">.cfg</span> <span class="s1">&#39;http://git.proformatique.com/?p=official/debian-installer.git;a=blob_plain;f=squeeze/installer.cfg;hb=6ee3ad5851ea7c0bb841cbd05e53835f483dd867&#39;</span>
<span class="nt">debconf-set-selections</span> <span class="o">&lt;</span> <span class="nt">installed</span><span class="nc">.cfg</span>
<span class="nt">wget</span> <span class="nt">-O</span> <span class="nt">pkg</span><span class="nc">.cfg</span> <span class="s1">&#39;http://git.proformatique.com/?p=official/debian-installer.git;a=blob_plain;f=squeeze/pkg.cfg;hb=127c11ffdb8f4ad42f59fce971f274cd0e079745&#39;</span>
<span class="nt">debconf-set-selections</span> <span class="o">&lt;</span> <span class="nt">pkg</span><span class="nc">.cfg</span>
</pre></div>


<p>The <a href="http://xivo.dachary.org/2011-02-28-manual-installation.txt">full log of the shell
session</a> was
archived. However, now that the repository is ready, it should be
possible to automatically install XiVO using the scripts from following
repositories:</p>
<ul>
<li>git://git.proformatique.com/official/debian-installer.git</li>
<li>git://git.proformatique.com/official/debian-pxelinux.git</li>
</ul>
<h4>packaging-farm release</h4>
<p>While fixing the XiVO skaro repository, a few problems were found and
fixed in <a href="http://packaging-farm.dachary.org/">packaging-farm</a> and
released as version 1.2.32. The ChangeLog reads : add architecture to
KVERS variables. load fakeroot in each dist-upgrade. input for apt-get
is /dev/null to avoid input problems. fix dpkg-scan bug when building
for multiple archictures.</p>
</p>
  </div>
</article>

  <div class="pagination">
    <a class="btn" href="http://blog.xivo.io/index32.html">
      <i class="fa fa-angle-left"></i> Older Posts
    </a>
      <a class="btn float-right" href="http://blog.xivo.io/index30.html">
        Newer Posts <i class="fa fa-angle-right"></i>
      </a>
  </div>

    <footer>
<p>
  &copy; XiVO developers 2015 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Create Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " XiVO Blog ",
  "url" : "http://blog.xivo.io",
  "image": "public/xivo-logo.png",
  "description": ""
}
</script></body>
</html>