<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="http://blog.xivo.io/theme/css/style.min.css">
  <link rel="stylesheet" type="text/css" href="http://blog.xivo.io/theme/css/pygments.min.css">
  <link rel="stylesheet" type="text/css" href="http://blog.xivo.io/theme/css/font-awesome.min.css">
  <link href="http://blog.xivo.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="XiVO Blog Atom">
  <link rel="shortcut icon" href="/public/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/public/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />
  <meta name="author" content="XiVO developers" />
  <meta name="description" content="" />
<meta property="og:site_name" content="XiVO Blog"/>
<meta property="og:type" content="blog"/>
<meta property="og:title" content="XiVO Blog"/>
<meta property="og:description" content=""/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://blog.xivo.io"/>
<meta property="og:image" content="public/xivo-logo.png">
  <title>XiVO Blog</title>
</head>
<body>
  <aside>
    <div>
      <a href="http://blog.xivo.io">
        <img src="public/xivo-logo.png" alt="" title="">
      </a>
      <h1><a href="http://blog.xivo.io"></a></h1>
      <p></p>
      <nav>
        <ul class="list">
          <li><a href="http://xivo.io" target="_blank">XiVO.io</a></li>
          <li><a href="http://documentation.xivo.io" target="_blank">Documentation</a></li>
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-twitter" href="http://twitter.com/xivodevteam" target="_blank"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-github" href="http://github.com/xivo-pbx" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-facebook" href="https://www.facebook.com/XiVO-86529730831" target="_blank"><i class="fa fa-facebook"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>
    <nav>
      <a href="http://blog.xivo.io">Home</a>
      <a href="/categories.html">Categories</a>
      <a href="/archives.html">Archives</a>
      <a href="http://blog.xivo.io/feeds/all.atom.xml">Atom</a>
    </nav>

<article>
  <header>
    <h2><a href="http://blog.xivo.io/creating-an-independant-xivo-debian-gnulinux-repository-from-scratch-part-24.html#creating-an-independant-xivo-debian-gnulinux-repository-from-scratch-part-24">Creating an independant XiVO Debian GNU/Linux repository from scratch (part 2/4)</a></h2>
    <p>
      Posted on Mon 14 February 2011 in <a href="http://blog.xivo.io/category/xivo-ipbx.html">XiVO IPBX</a>
    </p>
  </header>
  <div>
      <h4>Source package dependencies</h4>
<p>The<a href="http://xivo.dachary.org/packaging-farm/misdn-user/gnulinux/debian/i386/lenny/src/">misdn-user</a>package
depends on
the<a href="http://xivo.dachary.org/packaging-farm/misdn-kernel/gnulinux/debian/i386/lenny/src/">misdn-kernel</a>package.
Therefore, when misdn-kernel is updated, it may be necessaryto rebuild
the misdn-user package. There are no standard DebianGNU/Linux tools to
compute the dependency graph between two source packages. And it's not
astrivial as it seems, mainly because a source package creates one or
more binary packages.For instance misdn-user depends on misdn-headers
which is created by the misdn-kernel package.A
<a href="http://packaging-farm.dachary.org/packaging-farm/packaging-farm/lib/debian/depends.sh">script</a>
wascreated to compute the source package dependencies. Its input is a
set of debian/control filesand its output is a set of Makefile rules
such as:</p>
<div class="highlight"><pre><span></span>misdn-kernel ::
misdn-user ::  misdn-kernel
</pre></div>


<p>Note the <em>::</em> which allows for additional dependencies to appear later
in the Makefile. Thisgraph is abstract and would not be of any use
unless it is associated to actions such as:</p>
<div class="highlight"><pre><span></span>misdn-kernel :: /var/cache/packaging-farm/depends/misdn-kernel
/var/cache/packaging-farm/depends/misdn-kernel :: /var/cache/packaging-farm/sources/misdn-kernel/*/debian/control
        packaging-farm --cd misdn-kernel all
        touch $@
</pre></div>


<p>The
<a href="http://packaging-farm.dachary.org/packaging-farm/packaging-farm/lib/debian/depends.sh">depend.sh</a>
script createsthe above snippet for each package. The
<code>packaging-farm --cd misdn-kernel all</code> command creates all the
packagesfor misdn-kernel. If it succeeds, the
<code>/var/cache/packaging-farm/depends/misdn-kernel</code> timestamp is updatedand
the package is considered up to date. When a newer version of the
package is uploaded to the
<code>/var/cache/packaging-farm/sources/misdn-kernel</code>directory, the
<code>/var/cache/packaging-farm/sources/misdn-kernel/*/debian/control</code> file
will have a modificationtime more recent than the timestamp, thus
triggering the rebuild of all depending packages in the graph.</p>
<p>The last set of lines created by depend.sh are source lists that allow
each package to gain access to themost recently built version of the
other packages:</p>
<div class="highlight"><pre><span></span>define debian_SOURCE_LIST_APPEND
echo &quot;deb http://localhost/packaging-farm/misdn-kernel/gnulinux/debian/<span class="cp">${</span><span class="n">ARCHITECTURE</span><span class="cp">}</span>/<span class="cp">${</span><span class="n">DISTRIBUTION</span><span class="cp">}</span>/src ./&quot; &gt;&gt; $$source_list ; \\
echo &quot;deb http://localhost/packaging-farm/misdn-user/gnulinux/debian/<span class="cp">${</span><span class="n">ARCHITECTURE</span><span class="cp">}</span>/<span class="cp">${</span><span class="n">DISTRIBUTION</span><span class="cp">}</span>/src ./&quot; &gt;&gt; $$source_list ; \\
: finished
endef
</pre></div>


<p>It would be tempting to ensure that each package is given the source
list it needs and nothing more. However, unlessthe number of packages
handled on a single packaging farm grows over 100, it is probably
overkill. There are lessthan 50 package currently in XiVO.</p>
<p>A <a href="http://packaging-farm.dachary.org/download/packaging-farm_1.2.30.dsc">new version of
packaging-farm</a>
was published today, including support fordependencies, so that it can
be used to continue building a standalone XiVO repository.</p>
<h4>XiVO repository for i386 and x86_64</h4>
<p>With the newer installation of the packaging-farm including dependency
handling, another attempt to createa i386 based gallifrey repository for
lenny was made. For each package a command similar to</p>
<div class="highlight"><pre><span></span>packaging-farm misdn-kernel
</pre></div>


<p>was run. It is using the dependency graph to build the package and all
the packages it depends on before it.In the end a few packages could not
be built. Some of them because of trivial dependency problems thatwere
<a href="https://projects.proformatique.com/issues/1942">reported to Nicolas
Hicher</a> who agreed to
fix them momentarily.Another, more serious, is found in the
sangoma-wanpipe package. It relates to the fact that it pulls
dependenciesbased on the kernel flavor. The native host is amd64 /
x86_64 based and it fails when attempting to build in a i386chroot.
There probably are workarounds already implemented and looking into
pbuilder is probably the best lead.The <a href="http://xivo.dachary.org/packaging-farm/gallifrey/gnulinux/debian/i386/lenny/src/">i386 gallifrey
repository</a>
nowcontains more packages and there should be no major obstacle to
complete it once the dependency and architecture problemsare
resolved.Nicolas Hicher is almost done with porting the <a href="http://dak.proformatique.com/debian/dists/squeeze-xivo-skaro-dev/">skaro XiVO
packages to
squeeze</a>.
An attempt was made to buildthem for x86_64. The <a href="http://xivo.dachary.org/packaging-farm/skaro/gnulinux/debian/x86_64/squeeze/src/">result is still
incomplete</a>
but it should run when the last dependency problems are resolved.</p>
</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://blog.xivo.io/xivo-is-everywhere-part-3.html#xivo-is-everywhere-part-3">XiVO is everywhere part 3 !</a></h2>
    <p>
      Posted on Fri 11 February 2011 in <a href="http://blog.xivo.io/category/general.html">General</a>
    </p>
  </header>
  <div>
      <p>Hello, it's cold (-15), it's winter but XiVO is always here !</p>
<p><img alt="sylvain_xivo.png" src="/public/.sylvain_xivo_m.jpg" title="sylvain_xivo.png, fév. 2011" /></p>
<p>Special for you Bertrand ;)</p>
<p><img alt="IMG_20110211_144454.jpg" src="/public/.IMG_20110211_144454_m.jpg" title="IMG_20110211_144454.jpg, fév. 2011" /></p>
</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://blog.xivo.io/new-statistic-xivo-modules.html#new-statistic-xivo-modules">New statistic XiVO modules</a></h2>
    <p>
      Posted on Fri 11 February 2011 in <a href="http://blog.xivo.io/category/software.html">Software</a>
    </p>
  </header>
  <div>
      <p>I'm very proud to announce our <strong>new statistics module for XiVO</strong>.
Please see a first screenshot of this module below :</p>
<p><img alt="stats.png" src="/public/.stats_m.jpg" title="stats.png, fév. 2011" /></p>
<p>As you can see, we have integrated a full statistic module for our next
major version, Skaro. All existing statistics queues in Asterisk (GPLv3)
are not really usable and not suitable for a call center. Our previous
version is using Asternic with a lack of performances in the free
software version and namely in terms if counters from our customers
point of view.</p>
<p>We are implementing a cache system to have real-time results and stats.
The Asterisk queue CSV files can be importable within this module. In
order to produce graphics, we are using the jqplot library that gives us
very decent results.</p>
</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://blog.xivo.io/creating-an-independant-xivo-debian-gnulinux-repository-from-scratch-part-14.html#creating-an-independant-xivo-debian-gnulinux-repository-from-scratch-part-14">Creating an independant XiVO Debian GNU/Linux repository from scratch (part 1/4)</a></h2>
    <p>
      Posted on Mon 07 February 2011 in <a href="http://blog.xivo.io/category/xivo-ipbx.html">XiVO IPBX</a>
    </p>
  </header>
  <div>
      <h4>Extracting XiVO Gallifrey for Debian lenny</h4>
<p>After creating a virtual machine based on the recently published
DebianGNU/Linux squeeze, packaging-farm is installed from the
repository. Anothersource is added to extract the XiVO packages in
source form. Here we focuson <em>main</em> but the same principle can be done
for others.</p>
<div class="highlight"><pre><span></span><span class="k">deb</span> <span class="s">http://dak.proformatique.com/debian/</span> <span class="kp">lenny-xivo-gallifrey</span> <span class="kp">main</span>
<span class="k">deb-src</span> <span class="s">http://dak.proformatique.com/debian/</span> <span class="kp">lenny-xivo-gallifrey</span> <span class="kp">main</span>
</pre></div>


<p>packaging-farm expects to find package sources in
/var/cache/packaging-farm/sourceswithin a directory that is named after
the package. This hierarchy was build withthe following:</p>
<div class="highlight"><pre><span></span><span class="x">awk &#39;/^Package/</span><span class="err">{</span><span class="x">print </span><span class="p">$</span><span class="x">2}&#39; /var/lib/apt/lists/dak.proformatique.com_debian_dists_lenny-xivo-gallifrey_main_source_Sources | </span>
<span class="x">while read package </span>
<span class="x">do </span>
<span class="x">  ( rm -fr </span><span class="p">$</span><span class="nv">package</span><span class="x"> ; mkdir </span><span class="p">$</span><span class="nv">package</span><span class="x"> ; cd </span><span class="p">$</span><span class="nv">package</span><span class="x"> ; apt-get source </span><span class="p">$</span><span class="nv">package</span><span class="x"> )</span>
<span class="x">done</span>
</pre></div>


<p>In addition, a list of all known packages must be added to
/etc/packaging-farm/packaging-farm.conf and a variable containing the
directory where the chroot must be stored. The chroot is preserved if
the build fail, for debuging purpose. To keep the structure consistent,
a directory named after the package is created in /usr/src
(/usr/src/asterisk, /usr/src/dahdi-linux etc.). Each directory must
contain a Makefile that may contain exceptions or additional build
instructions for the farm. Since there is no need for such tweaking at
the moment, the Makefiles are generated:</p>
<div class="highlight"><pre><span></span>for package in asterisk asterisk-addons asterisk-app-conference asterisk-chan-capi asterisk-chan-sccp asterisk-sounds-gsm-de-de asterisk-sounds-wav-en-us asterisk-sounds-wav-es-es asterisk-sounds-wav-fr-ca bntools dahdi-linux dahdi-tools libasterisk-perl libpri misdn-kernel misdn-user pf-asterisk-ami-aoriginate pf-asterisk-app-fax pf-asterisk-app-nv-faxdetect pf-asterisk-module-xivo pf-asterisk-prompt-fr pf-asterisk-prompt-fr-xivo pf-asterisk-prompts-xivo pf-asterisk-res-sqlite2 pf-asterisk-res-watchdog pf-asternic-stats pf-sources.list-ldlc pf-xivo pf-xivo-agid pf-xivo-backup pf-xivo-base-config pf-xivo-cti-server pf-xivo-cti-webclient pf-xivo-extra pf-xivo-fetchfw pf-xivo-lib-python pf-xivo-provisioning pf-xivo-queues-logger pf-xivo-sysconfd pf-xivo-utils pf-xivo-web-interface sangoma-wanpipe spandsp ; do
cat &gt; /usr/src/<span class="nv">$package</span>/Makefile <span class="err">&lt;</span><span class="nt">&lt;EOF</span>
<span class="na">PACKAGE=</span><span class="s">$package</span>
<span class="na">DISTRIBUTIONS=</span><span class="s">lenny</span>
<span class="na">ARCHITECTURES=</span><span class="s">i386</span>
<span class="err">LIBDIR</span> <span class="err">?=</span> <span class="err">/usr/lib/packaging-farm</span>
<span class="err">include</span> <span class="err">\${LIBDIR}/Makefile</span>
<span class="err">EOF</span>
<span class="err">done</span>
</pre></div>


<h4>Source package dependencies</h4>
<p>The packaging-farm does not know anything about source package
dependencies. For instance a number of XiVO packages depend on asterisk,
therefore they need to be rebuilt if a new asterisk package is
published. In preparation for a patch submission to add support for
source package dependencies, a set of shell commands have been performed
to generate a set of dependencies written as Makefile entries:</p>
<div class="highlight"><pre><span></span><span class="err">#</span> <span class="nt">these</span> <span class="nt">lines</span> <span class="nt">are</span> <span class="nt">approximations</span> <span class="nt">that</span> <span class="nt">won</span><span class="s1">&#39;t work out of the box</span>
<span class="s1"># list all packages for each source package</span>
<span class="s1">cat  */*/debian/control | perl -ne &#39;</span><span class="nt">print</span> <span class="s2">&quot;$1|&quot;</span> <span class="nt">if</span><span class="o">(</span><span class="nt">s</span><span class="o">/^</span><span class="nt">Package</span><span class="o">:</span><span class="err">\</span><span class="nt">s</span><span class="o">*(.*)</span><span class="err">\</span><span class="nt">s</span><span class="o">*//)</span><span class="s1">&#39;</span>
<span class="s1"># map package to corresponding source package</span>
<span class="s1">cat /tmp/list_of_source_packages | while read package ; do cat $package/*/debian/control | perl -ne &#39;</span><span class="nt">s</span><span class="o">/</span><span class="cp">[</span><span class="nx">.</span><span class="o">-</span><span class="cp">]</span><span class="o">/</span><span class="nt">_</span><span class="o">/</span><span class="nt">g</span><span class="o">;</span> <span class="nt">print</span> <span class="s2">&quot;$1=&#39;$package&#39;\</span>
<span class="s2">&quot;</span> <span class="nt">if</span><span class="o">(</span><span class="nt">s</span><span class="o">/^</span><span class="nt">Package</span><span class="o">:</span><span class="err">\</span><span class="nt">s</span><span class="o">*(.*)</span><span class="err">\</span><span class="nt">s</span><span class="o">*//)</span><span class="s1">&#39; ; done</span>
<span class="s1"># create the makefile entries</span>
<span class="s1">for package in asterisk asterisk-addons asterisk-app-conference asterisk-chan-capi asterisk-chan-sccp asterisk-sounds-gsm-de-de asterisk-sounds-wav-en-us asterisk-sounds-wav-es-es asterisk-sounds-wav-fr-ca bntools dahdi-linux dahdi-tools libasterisk-perl libpri misdn-kernel misdn-user pf-asterisk-ami-aoriginate pf-asterisk-app-fax pf-asterisk-app-nv-faxdetect pf-asterisk-module-xivo pf-asterisk-prompt-fr pf-asterisk-prompt-fr-xivo pf-asterisk-prompts-xivo pf-asterisk-res-sqlite2 pf-asterisk-res-watchdog pf-asternic-stats pf-sources.list-ldlc pf-xivo pf-xivo-agid pf-xivo-backup pf-xivo-base-config pf-xivo-cti-server pf-xivo-cti-webclient pf-xivo-extra pf-xivo-fetchfw pf-xivo-lib-python pf-xivo-provisioning pf-xivo-queues-logger pf-xivo-sysconfd pf-xivo-utils pf-xivo-web-interface sangoma-wanpipe spandsp ; do echo -n &quot;$package :: &quot; ; perl -ne &#39;</span><span class="nt">if</span><span class="o">(/^</span><span class="nt">Build-Depends</span><span class="o">/)</span> <span class="p">{</span> <span class="n">while</span><span class="p">(</span><span class="o">/</span><span class="p">(</span><span class="n">asterisk</span><span class="o">-</span><span class="n">mysql</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">mp3</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">ooh323c</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="n">conference</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="n">conference</span><span class="o">-</span><span class="n">dbg</span><span class="o">|</span><span class="n">asterisk</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">common</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">dev</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">sounds</span><span class="o">-</span><span class="n">main</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">web</span><span class="o">-</span><span class="n">vmail</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">config</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">classic</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">classic</span><span class="o">-</span><span class="n">dbg</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">chan</span><span class="o">-</span><span class="n">capi</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">chan</span><span class="o">-</span><span class="n">capi</span><span class="o">-</span><span class="n">dbg</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">chan</span><span class="o">-</span><span class="n">sccp</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">chan</span><span class="o">-</span><span class="n">sccp</span><span class="o">-</span><span class="n">dbg</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">sounds</span><span class="o">-</span><span class="n">gsm</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">de</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">sounds</span><span class="o">-</span><span class="n">wav</span><span class="o">-</span><span class="n">en</span><span class="o">-</span><span class="n">us</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">sounds</span><span class="o">-</span><span class="n">wav</span><span class="o">-</span><span class="n">es</span><span class="o">-</span><span class="n">es</span><span class="o">|</span><span class="n">asterisk</span><span class="o">-</span><span class="n">sounds</span><span class="o">-</span><span class="n">wav</span><span class="o">-</span><span class="n">fr</span><span class="o">-</span><span class="n">ca</span><span class="o">|</span><span class="n">bntools</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">asterisk</span><span class="o">-</span><span class="n">res</span><span class="o">-</span><span class="n">bnfos</span><span class="o">|</span><span class="n">dahdi</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">source</span><span class="o">|</span><span class="n">dahdi</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">modules</span><span class="o">-</span><span class="n">common</span><span class="o">|</span><span class="n">dahdi</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">dev</span><span class="o">|</span><span class="n">dahdi</span><span class="o">-</span><span class="n">tools</span><span class="o">|</span><span class="n">libtonezone1</span><span class="o">|</span><span class="n">libtonezone</span><span class="o">-</span><span class="n">dev</span><span class="o">|</span><span class="n">libasterisk</span><span class="o">-</span><span class="n">perl</span><span class="o">|</span><span class="n">libpri</span><span class="o">-</span><span class="n">dev</span><span class="o">|</span><span class="n">libpri1</span><span class="o">.</span><span class="m">4</span><span class="o">|</span><span class="n">misdn</span><span class="o">-</span><span class="n">kernel</span><span class="o">-</span><span class="n">source</span><span class="o">|</span><span class="n">misdn</span><span class="o">|</span><span class="n">misdn</span><span class="o">-</span><span class="n">headers</span><span class="o">|</span><span class="n">misdn</span><span class="o">-</span><span class="n">utils</span><span class="o">|</span><span class="n">misdn</span><span class="o">-</span><span class="n">dbg</span><span class="o">|</span><span class="n">libmisdn0</span><span class="o">|</span><span class="n">libmisdn</span><span class="o">-</span><span class="n">dev</span><span class="o">|</span><span class="n">libisdnnet0</span><span class="o">|</span><span class="n">libisdnnet</span><span class="o">-</span><span class="n">dev</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">asterisk</span><span class="o">-</span><span class="n">ami</span><span class="o">-</span><span class="n">aoriginate</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">asterisk</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="n">fax</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">asterisk</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="n">fax</span><span class="o">-</span><span class="n">dbg</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">asterisk</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="n">nv</span><span class="o">-</span><span class="n">faxdetect</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">asterisk</span><span class="o">-</span><span class="n">module</span><span class="o">-</span><span class="n">xivo</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">asterisk</span><span class="o">-</span><span class="n">prompt</span><span class="o">-</span><span class="n">fr</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">asterisk</span><span class="o">-</span><span class="n">prompt</span><span class="o">-</span><span class="n">fr</span><span class="o">-</span><span class="n">xivo</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">asterisk</span><span class="o">-</span><span class="n">prompt</span><span class="o">-</span><span class="n">fr</span><span class="o">-</span><span class="n">fr</span><span class="o">-</span><span class="n">xivo</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">asterisk</span><span class="o">-</span><span class="n">prompt</span><span class="o">-</span><span class="n">fr</span><span class="o">-</span><span class="n">ca</span><span class="o">-</span><span class="n">xivo</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">asterisk</span><span class="o">-</span><span class="n">res</span><span class="o">-</span><span class="n">sqlite2</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">asterisk</span><span class="o">-</span><span class="n">res</span><span class="o">-</span><span class="n">sqlite2</span><span class="o">-</span><span class="n">dbg</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">asterisk</span><span class="o">-</span><span class="n">res</span><span class="o">-</span><span class="n">watchdog</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">asternic</span><span class="o">-</span><span class="n">stats</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">sources</span><span class="o">.</span><span class="n">list</span><span class="o">-</span><span class="n">ldlc</span><span class="o">-</span><span class="n">xivo</span><span class="m">-1</span><span class="o">.</span><span class="m">1</span><span class="o">-</span><span class="n">gallifrey</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">agid</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">backup</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">base</span><span class="o">-</span><span class="n">config</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">cti</span><span class="o">-</span><span class="n">server</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">cti</span><span class="o">-</span><span class="n">webclient</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">extra</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">fetchfw</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">lib</span><span class="o">-</span><span class="n">python</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">debug</span><span class="o">-</span><span class="n">tools</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">provisioning</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">queues</span><span class="o">-</span><span class="n">logger</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">sysconfd</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">utils</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">web</span><span class="o">-</span><span class="n">interface</span><span class="o">|</span><span class="n">pf</span><span class="o">-</span><span class="n">xivo</span><span class="o">-</span><span class="n">web</span><span class="o">-</span><span class="n">interface</span><span class="o">-</span><span class="n">config</span><span class="o">|</span><span class="n">sangoma</span><span class="o">-</span><span class="n">wanpipe</span><span class="o">-</span><span class="n">tools</span><span class="o">|</span><span class="n">sangoma</span><span class="o">-</span><span class="n">dbg</span><span class="o">|</span><span class="n">sangoma</span><span class="o">-</span><span class="n">wanpipe</span><span class="o">-</span><span class="n">source</span><span class="o">|</span><span class="n">libspandsp3</span><span class="o">|</span><span class="n">libspandsp</span><span class="o">-</span><span class="n">dev</span><span class="o">|</span><span class="n">libspandsp3</span><span class="o">-</span><span class="n">dbg</span><span class="o">|</span><span class="n">libspandsp</span><span class="o">-</span><span class="n">doc</span><span class="p">)</span><span class="o">/</span><span class="n">g</span><span class="p">)</span> <span class="err">{</span> <span class="n">print</span> <span class="s2">&quot;$1\</span>
<span class="s2">&quot;</span><span class="p">;</span> <span class="p">}</span> <span class="err">}</span><span class="s1">&#39; &lt; /var/cache/packaging-farm/sources/$package/*/debian/control | sort -u | while read source ; do echo -n &#39;</span> <span class="s1">&#39; ; eval echo -n \$$(echo $source | sed -e &#39;</span><span class="nt">s</span><span class="o">/</span><span class="cp">[</span><span class="nx">.</span><span class="o">-</span><span class="cp">]</span><span class="o">/</span><span class="nt">_</span><span class="o">/</span><span class="nt">g</span><span class="err">&#39;</span><span class="o">)</span> <span class="o">;</span> <span class="nt">done</span> <span class="o">;</span> <span class="nt">echo</span> <span class="o">;</span> <span class="nt">done</span>
</pre></div>


<p>created:</p>
<div class="highlight"><pre><span></span># level 4
pf-asterisk-ami-aoriginate ::  asterisk
pf-asterisk-app-fax ::  asterisk spandsp
pf-asterisk-app-nv-faxdetect ::  asterisk
pf-asterisk-module-xivo ::  asterisk
pf-asterisk-res-sqlite2 ::  asterisk
pf-asterisk-res-watchdog ::  asterisk
asterisk-addons ::  asterisk
asterisk-app-conference ::  asterisk
asterisk-chan-capi ::  asterisk
asterisk-chan-sccp ::  asterisk
bntools ::  asterisk
# level 3
asterisk ::  dahdi-linux misdn-user libpri dahdi-tools misdn-kernel
# level 2
dahdi-tools ::  dahdi-linux
sangoma-wanpipe ::  dahdi-linux
misdn-user ::  misdn-kernel
# level 1
asterisk-sounds-gsm-de-de asterisk-sounds-wav-en-us asterisk-sounds-wav-es-es asterisk-sounds-wav-fr-ca dahdi-linux libasterisk-perl libpri misdn-kernel pf-asterisk-prompt-fr pf-asterisk-prompt-fr-xivo pf-asterisk-prompts-xivo pf-asternic-stats pf-sources.list-ldlc pf-xivo pf-xivo-agid pf-xivo-backup pf-xivo-base-config pf-xivo-cti-server pf-xivo-cti-webclient pf-xivo-extra pf-xivo-fetchfw pf-xivo-lib-python pf-xivo-provisioning pf-xivo-queues-logger pf-xivo-sysconfd pf-xivo-utils pf-xivo-web-interface spandsp  ::
</pre></div>


<p>The dependencies were used to figure out the manual order in which the
packages must be built. After checking that all packages without
dependencies could be successfully built
(<a href="http://xivo.dachary.org/packaging-farm/misdn-kernel/gnulinux/debian/i386/lenny/src/">misdn-kernel</a>,
<a href="http://xivo.dachary.org/packaging-farm/dahdi-linux/gnulinux/debian/i386/lenny/src/">dahdi-linux</a>
and <a href="http://xivo.dachary.org/packaging-farm/">more</a>), the idea was to
encode the dependencies in the Makefile for each package.</p>
<div class="highlight"><pre><span></span><span class="x">for i in asterisk-sounds-gsm-de-de asterisk-sounds-wav-en-us asterisk-sounds-wav-es-es asterisk-sounds-wav-fr-ca dahdi-linux libasterisk-perl libpri misdn-kernel pf-asterisk-prompt-fr pf-asterisk-prompt-fr-xivo pf-asterisk-prompts-xivo pf-asternic-stats pf-sources.list-ldlc pf-xivo pf-xivo-agid pf-xivo-backup pf-xivo-base-config pf-xivo-cti-server pf-xivo-cti-webclient pf-xivo-extra pf-xivo-fetchfw pf-xivo-lib-python pf-xivo-provisioning pf-xivo-queues-logger pf-xivo-sysconfd pf-xivo-utils pf-xivo-web-interface spandsp  ; do ( echo --------------------------- ; echo </span><span class="p">$</span><span class="nv">i</span><span class="x"> ; cd </span><span class="p">$</span><span class="nv">i</span><span class="x"> ; make all ) ; done</span>
</pre></div>


<p>In packaging-farm, when a package is built, a new debian repository is
created just for this package and only contains its package. In the case
of misdn-user the repository of misdn-kernel (see above : it depends on
it) would need to be added to the description of the misdn-user package.
Although this may be fine for a few packages, four level of dependencies
makes it tedious and error prone. It would be unwise to try it manually.</p>
<h4>Aggregation of the results</h4>
<p>XiVO is made of dozens of packages and it would be most inconvenient to
add so many lines to a source list. Instead, a <a href="http://xivo.dachary.org/packaging-farm/gallifrey/Makefile">galifrey meta
package</a> is
created in the packaging-farm with the sole purpose of copying all
packages in a <a href="http://xivo.dachary.org/packaging-farm/gallifrey/gnulinux/debian/i386/lenny/src/">single
repository</a>.
The following line could be added to a virgin Debian GNU/linux lenny
source list and should now be equivalent to its counterpart on
http://dak.proformatique.com/debian/</p>
<div class="highlight"><pre><span></span><span class="k">deb</span> <span class="s">http://xivo.dachary.org/packaging-farm/gallifrey/gnulinux/debian/i386/lenny/src/</span> <span class="kp">./</span>
<span class="k">deb-src</span> <span class="s">http://xivo.dachary.org/packaging-farm/gallifrey/gnulinux/debian/i386/lenny/src/</span> <span class="kp">./</span>
</pre></div>


<h4>Implementing dependency handling in packaging-farm</h4>
<p>Although an i386 repository is now available for the XiVO packages which
solely depend on Debian GNU/Linux lenny, it would be tedious to manually
arrange the packaging-farm to accomodate for the four level of
dependencies. Instead packaging-farm should be modified to handle
interdepencies of packages. Although it would be possible to arrange for
the other operations to be supported by a specific tool (for instance
importing all the packages from a known repository), such an operation
is not frequent and the time to properly write such a tool and make sure
it works as expected probably outweights the benefit.</p>
</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="http://blog.xivo.io/xivo-client-packaging-server-source-policy-and-packaging-farm-updates.html#xivo-client-packaging-server-source-policy-and-packaging-farm-updates">XiVO client packaging, server source policy and packaging-farm updates</a></h2>
    <p>
      Posted on Mon 31 January 2011 in <a href="http://blog.xivo.io/category/xivo-ipbx.html">XiVO IPBX</a>
    </p>
  </header>
  <div>
      <h4>XiVO Qt client packaging</h4>
<p>The resulting packages are then uploaded to a directory that depends on
the operating system :</p>
<ul>
<li><a href="http://downloads.xivo.fr/xivo_cti_client/linux/debian/">Debian GNU/Linux i386 and
    amd64</a></li>
<li><a href="http://downloads.xivo.fr/xivo_cti_client/win32/">Windows</a></li>
<li><a href="http://downloads.xivo.fr/xivo_cti_client/macos/">MacOsX</a></li>
</ul>
<p>The Debian GNU/Linux packages are created by a <a href="http://git.proformatique.com/?p=official/xivo-client-qt.git;a=blob;f=cross/installer.sh">custom
script</a>
that builds the binary .deb file using the binary produced by the
compilation. There is no corresponding source package. The MacOsX .dmg
are created by a <a href="http://git.proformatique.com/?p=official/xivo-client-qt.git;a=blob;f=cross/build_config/on-MacOsX-SnowLeopard">custom
script</a>.</p>
<p>The Windows .exe are created by a
<a href="http://en.wikipedia.org/wiki/Nullsoft_Scriptable_Install_System">NSIS</a>
<a href="http://git.proformatique.com/?p=official/xivo-client-qt.git;a=blob;f=cross/installer_config/win32-shared">script</a>.</p>
<h4>Other XiVO clients</h4>
<p>The XiVO web interface is made of a JQuery based
<a href="http://git.proformatique.com/?p=official/xivo-client-web.git">webapp</a>
relying on web services provided by the XiVO server. It is not packaged
on its own : when the user connects to the PHP based web interface (as
found in the web-interface directory of the <a href="http://git.xivo.fr/xivo-skaro.git/">git
repository</a>) the browser loads it as
a side effect.</p>
<p>The XiVO android client is packaged using the Eclipse based toolkit.</p>
<h4>XiVO server packaging source policy</h4>
<p>The <a href="http://git.xivo.fr/">XiVO server sources</a> and the corresponding
Debian GNU/Linux packaging instructions follow an undocumented policy.
The SVN respository containing the packaging instructions is not
published but it can be re-constructed from the Debian GNU/Linux
directories found in the source packages of the <a href="http://dak.proformatique.com/debian/">XiVO Debian GNU/Linux
repository</a>.</p>
<ul>
<li>All packages authored by Avencall start with the pf- prefix (for
    instance pf-xivo-fetchfw)</li>
<li>The Debian GNU/Linux package of third party packages (asterisk
    for instance) is a fork of the official package that may or may not
    be synchronized with it. In particular patches applied to the
    upstream in Debian GNU/Linux may or may not be applied in the
    XiVO distribution.</li>
<li>A third party package source tree is made of (take a look at the
    freeswitch directory of the <a href="http://git.xivo.fr/xivo-skaro.git/">git
    repository</a> for an example):<ul>
<li>tarballs that contains all past and current source archives</li>
<li>fetch_tarball.sh that will get the latest source archive from
    the official source and place it in the tarballs directory</li>
<li>Makefile.pkg that contains the name of the directory in
    the (unpublished) SVN repository containing the debian package
    (for freeswitch it is : DEB_PKG = "freeswitch")</li>
<li>prepare_test_sources.sh is a script that:<ul>
<li>unpacks the source archive</li>
<li>apply the patches (which may be in the debian directory or
    in the source directory) (freeswitch has no patch although
    it contains a call to quilt)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>An unpublished tool has been used consistently over the years and rely
on this policy. The purpose of this tool is essentially the same as the
Debian GNU/Linux
<a href="http://wiki.debian.org/DebianWannaBuildInfrastructure">WannaBuild</a> or
<a href="https://launchpad.net/">launchpad</a>.</p>
<h4>packaging-farm multi architecture support</h4>
<p>A new release of <a href="http://packaging-farm.dachary.org">packaging-farm</a> was
published Sunday 30 January, including the following features:</p>
<ul>
<li>Basic multi-architecture support : i386 and x86_64 are supported
    when running the packaging-farm on an x86_64 platform. It should
    ultimately rely on a slave virtual machine, either running localy or
    on a remote machine.</li>
</ul>
<!-- -->

<ul>
<li>Support for the currently active
    <a href="https://wiki.ubuntu.com/Releases">ubuntu</a> releases.</li>
</ul>
<p>It is still unclear how packaging-farm could be used to create
multi-distribution and multi-architecture packages for XiVO and that
will be my focus for the following weeks.</p>
</p>
  </div>
</article>

  <div class="pagination">
    <a class="btn" href="http://blog.xivo.io/index34.html">
      <i class="fa fa-angle-left"></i> Older Posts
    </a>
      <a class="btn float-right" href="http://blog.xivo.io/index32.html">
        Newer Posts <i class="fa fa-angle-right"></i>
      </a>
  </div>

    <footer>
<p>
  &copy; XiVO developers 2015 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Create Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " XiVO Blog ",
  "url" : "http://blog.xivo.io",
  "image": "public/xivo-logo.png",
  "description": ""
}
</script></body>
</html>